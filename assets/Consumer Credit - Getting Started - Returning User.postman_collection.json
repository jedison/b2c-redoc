{
	"info": {
		"_postman_id": "f65c1f1d-3127-4b15-9ee6-0b85182b16e5",
		"name": "StitchCredit - Getting Started - Returning User",
		"description": "Consumer API - Getting Started Instructions  \r\nUse the provided Postman Environment in conjunction with this collection of requests.  \r\nThe steps are provided in order to handle a returning user and retrieve the data.  \r\n\r\nThe Consumer Credit - Getting Started - Returning User.postman_collection.json will walk you through the Returning User steps in order",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Step 1: Customer Login",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "c973714d-5902-4cb8-a5f7-a0668ecbfba9",
						"exec": [
							"var data = pm.response.json();",
							"if(data) {",
							"    if(data.token) pm.environment.set(\"dtoken\",data.token);",
							"    if(data.refresh) pm.environment.set(\"rdtoken\",data.refresh);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"secret\": \"{{SECRET}}\",\n    \"apikey\": \"{{API_KEY}}\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{PROTOCOL}}://{{HOST}}:{{PORT}}{{BASE_URL}}/direct/login",
					"protocol": "{{PROTOCOL}}",
					"host": [
						"{{HOST}}"
					],
					"port": "{{PORT}}{{BASE_URL}}",
					"path": [
						"direct",
						"login"
					]
				},
				"description": "Using your credentials in the request body (\"apikey\" and \"secret\"), the response will contain the token and refresh token.  \r\nThese tokens are required for completing the other requests to Direct API endpoints.\r\n\r\nThis token will be valid for approximately one hour. After the one hour, the refresh token will become valid.\r\n\r\nIf the token expires, use /direct/refresh-token?token={refresh} to get a new token"
			},
			"response": []
		},
		{
			"name": "Step 2: New User Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "75867ce0-7f8d-4531-a7f1-9939d485fb60",
						"exec": [
							"var data = pm.response.json();",
							"if (data) {",
							"    if (data.token) pm.environment.set(\"paToken\", data.token);",
							"    if (data.userId) pm.environment.set(\"userId\", data.userId);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{dtoken}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"type": "text",
						"value": "application/json"
					}
				],
				"url": {
					"raw": "{{PROTOCOL}}://{{HOST}}:{{PORT}}{{BASE_URL}}/direct/preauth-token/{{userId}}",
					"protocol": "{{PROTOCOL}}",
					"host": [
						"{{HOST}}"
					],
					"port": "{{PORT}}{{BASE_URL}}",
					"path": [
						"direct",
						"preauth-token",
						"{{userId}}"
					]
				},
				"description": "This request uses userId (from the response of /direct/user-reg) to generate a User Token.\r\n\r\nThe Preauth Token needed for this request is also generated by /direct/user-reg or /direct/preauth-token"
			},
			"response": []
		},
		{
			"name": "Step 3: Preauth Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "4ec1bd9d-1e69-4bee-ab8f-e62bfb4936a2",
						"exec": [
							"var data = pm.response.json();\r",
							"if (data) {\r",
							"    if (data.token) pm.environment.set(\"utoken\", data.token);\r",
							"    if (data.refresh) pm.environment.set(\"rutoken\", data.refresh);\r",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{PROTOCOL}}://{{HOST}}:{{PORT}}{{BASE_URL}}/users/preauth-token/{{paToken}}",
					"protocol": "{{PROTOCOL}}",
					"host": [
						"{{HOST}}"
					],
					"port": "{{PORT}}{{BASE_URL}}",
					"path": [
						"users",
						"preauth-token",
						"{{paToken}}"
					]
				},
				"description": "This request uses **userId** (from the response of **/direct/user-reg**) to generate a **User Token**.\r\n\r\n*The Preauth Token needed for this request is also generated by* ***/direct/user-reg*** *or* ***/direct/preauth-token***"
			},
			"response": []
		},
		{
			"name": "Step 4: Get EFX Config",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "91b6c3dd-27b6-4247-951d-64bdbcd84a3f",
						"exec": [
							"var data = pm.response.json();",
							"pm.environment.set(\"efx_url\",data.url);",
							"pm.environment.set(\"efx_api_key\",data.id);",
							"pm.environment.set(\"efx_assertion\",data.secret);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "bearer",
					"bearer": [
						{
							"key": "token",
							"value": "{{utoken}}",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"type": "text",
						"value": "application/json"
					}
				],
				"url": {
					"raw": "{{PROTOCOL}}://{{HOST}}:{{PORT}}{{BASE_URL}}/users/efx-config",
					"protocol": "{{PROTOCOL}}",
					"host": [
						"{{HOST}}"
					],
					"port": "{{PORT}}{{BASE_URL}}",
					"path": [
						"users",
						"efx-config"
					]
				},
				"description": "Use this endpoint to get the Equifax credentials and url\r\n\r\nThese will be needed for the consumer app to send requests to the Equifax API."
			},
			"response": []
		},
		{
			"name": "Step 5: OAUTH Token",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "765b8623-45f4-41ab-9d6a-77cd709b4612",
						"exec": [
							"var response = JSON.parse(responseBody);",
							"postman.setEnvironmentVariable(\"efxtoken\", response.access_token);",
							"tests[\"Status code is 200\"] = responseCode.code === 200;"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "urlencoded",
					"urlencoded": [
						{
							"key": "scope",
							"value": "delivery",
							"type": "text"
						},
						{
							"key": "grant_type",
							"value": "jwt-bearer",
							"type": "text"
						},
						{
							"key": "api_key",
							"value": "{{efx_api_key}}",
							"type": "text"
						},
						{
							"key": "client_assertion",
							"value": "{{efx_assertion}}",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{efx_url}}/oauth/token",
					"host": [
						"{{efx_url}}"
					],
					"path": [
						"oauth",
						"token"
					]
				},
				"description": "For this path parameter, {efx_url}, use the url found in the response of a call to /users/efx-config.\r\n\r\nA successful request to {efx_url}/oauth/token will return credentials required for other Equifax API calls."
			},
			"response": []
		},
		{
			"name": "[Step 6]: Credit Monitoring",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{efxtoken}}"
					}
				],
				"url": {
					"raw": "{{efx_url}}/v1/creditMonitoring?format=json",
					"host": [
						"{{efx_url}}"
					],
					"path": [
						"v1",
						"creditMonitoring"
					],
					"query": [
						{
							"key": "format",
							"value": "json"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "[Step 6]: Credit Score Latest",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{efxtoken}}"
					}
				],
				"url": {
					"raw": "{{efx_url}}/v1/creditScore/latest?format=json",
					"host": [
						"{{efx_url}}"
					],
					"path": [
						"v1",
						"creditScore",
						"latest"
					],
					"query": [
						{
							"key": "format",
							"value": "json"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "[Step 6]: Credit Score History",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{efxtoken}}"
					}
				],
				"url": {
					"raw": "{{efx_url}}/v1/creditScore/history?historicalLimit=24&format=json",
					"host": [
						"{{efx_url}}"
					],
					"path": [
						"v1",
						"creditScore",
						"history"
					],
					"query": [
						{
							"key": "historicalLimit",
							"value": "24"
						},
						{
							"key": "format",
							"value": "json"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Step 7: Credit Report List",
			"event": [
				{
					"listen": "test",
					"script": {
						"id": "c1e02ed8-b430-4b11-9129-b3c55c5177e2",
						"exec": [
							"var data = pm.response.json();",
							"pm.environment.set(\"reportId\",data[0].id);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{efxtoken}}"
					}
				],
				"url": {
					"raw": "{{efx_url}}/v1/creditReport?format=json",
					"host": [
						"{{efx_url}}"
					],
					"path": [
						"v1",
						"creditReport"
					],
					"query": [
						{
							"key": "format",
							"value": "json"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "[Step 8]: Credit Report Summary (First in list)",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{efxtoken}}"
					}
				],
				"url": {
					"raw": "{{efx_url}}/v1/creditReport/{{reportId}}/summary?format=json",
					"host": [
						"{{efx_url}}"
					],
					"path": [
						"v1",
						"creditReport",
						"{{reportId}}",
						"summary"
					],
					"query": [
						{
							"key": "format",
							"value": "json"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "[Step 8]: Full Credit Report (First in list)",
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{efxtoken}}"
					}
				],
				"url": {
					"raw": "{{efx_url}}/v1/creditReport/{{reportId}}?format=json",
					"host": [
						"{{efx_url}}"
					],
					"path": [
						"v1",
						"creditReport",
						"{{reportId}}"
					],
					"query": [
						{
							"key": "format",
							"value": "json"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "[Step 8]: Credit Report (First in list) - PRINT",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{efx_url}}/v1/creditReport/{{reportId}}/print?access_token={{efxtoken}}",
					"host": [
						"{{efx_url}}"
					],
					"path": [
						"v1",
						"creditReport",
						"{{reportId}}",
						"print"
					],
					"query": [
						{
							"key": "access_token",
							"value": "{{efxtoken}}"
						}
					]
				}
			},
			"response": []
		}
	],
	"protocolProfileBehavior": {}
}